
½µ#
if [ "$0" = "/dev/stdin" ]; then
# ----------------------------------------------------------------
# update $symb folder for others ... (Jose S. Furutani)
 symb='minimal'
 key='QmVQd43Y5DQutAbgqiQkZtKJNd8mJiZr9Eq8D7ac2PeSL1'
 qm='QmaVkQ1pKqY5GAave8161z7eZHCs6kZoAFzyuHv5yWhwYe'
if ipath=$(ipms --timeout 5s resolve /ipns/$key 2>/dev/null); then
 echo "$symb: $ipath # (global)"
else
  # default to ...
  ipath="/ipfs/$qm"
  echo "$symb: ${qm} # (default)"
fi
if ipms files stat --hash /.brings 1>/dev/null 2>&1; then
  if pv=$(ipms files stat --hash /.brings/$symb 2>/dev/null); then
    ipms files mv /.brings/$symb /.brings/${symb}~
    if ipms files rm -r /.brings/${symb}~/prev 2>/dev/null; then true; fi
    npv=$(ipms files stat --hash /.brings/${symb}~) # w/o prev
    ipms files rm -r /.brings/${symb}~
    ipms files cp $ipath /.brings/$symb
    if ipms files rm -r /.brings/$symb/prev 2>/dev/null; then true; fi
    nqm=$(ipms files stat --hash /.brings/${symb}) # w/o prev
    if [ "$nqm" != "$npv" ]; then 
      ipms files cp /ipfs/$pv /.brings/$symb/prev
      ipath=/ipfs/$(ipms files stat --hash /.brings/$symb)
      echo "$symb: ${ipath#/ipfs/} # (new)"
    fi
  else
    ipms files cp $ipath /.brings/$symb
  fi
else
  ipms files mkdir /.brings
  ipms files cp $ipath /.brings/$symb
fi
# ---------------------------------------------------------------------
else
if echo "$0" | grep -q '^/'; then
  rootdir="${0%/bin/*}"
else
  rootdir="$(pwd)"; rootdir="${rootdir%/bin}"
fi
symb="${rootdir##*/}"
if ipms key list | grep -q -w $symb; then
 key=$(ipms key list -l | grep -w $symb | cut -d' ' -f 1)
 echo key: $key
 if test -d $rootdir; then
   qm=$(ipfs add -r -Q $rootdir)
   sed -i -e "s/symb='.*'$/symb='$symb'/" \
          -e "s/qm='.*'$/qm='$qm'/" \
          -e "s,ipath='/ipfs/.*'$,ipath='/ipfs/$qm'," \
          -e "s/key='.*'$/key='$key'/" $0 # $'s are important
   ipfs name publish --allow-offline --key=$symb /ipfs/$qm
 fi
fi
fi
exit $?

µ