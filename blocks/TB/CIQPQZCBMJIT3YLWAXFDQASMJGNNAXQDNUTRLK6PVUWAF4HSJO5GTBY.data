
…ý#
main (){
peer="$1";
myqm=$(ipms files stat --hash /my)
echo self@ipfs: /my=/ipfs/$myqm
if ipms files stat --hash /my/friends/peerids.yml 1>/dev/null 2>&1; then
 append_file "- $peer" /my/friends/peerids.yml
else
 peerid=$(ipfs --offline config Identity.PeerID)
 cat | ipfs files write --create --truncate /my/friends/peerids.yml <<EOF
--- # friends
# $PeerID: $peerid$
- $peer
EOF
fi
echo info: $peer added to /ipfs/$myqm/friends/peerids.yml

}

append_file(){
   text=$1;
   file=$2;
   fname=${file##*/}
   if ipfs files stat --hash ${file} 1>/dev/null 2>&1; then
     ipfs files read "${file}" > /tmp/${fname}
     echo "$text" >> /tmp/${fname}
     ipfs files write --create  --truncate "${file}" < /tmp/${fname}
     rm -f /tmp/${fname}
   else 
     echo "$text" |  ipfs files write --create  --truncate "${file}" 
   fi
}

main $@;
exit $?
true; # $Source: /.brings/logs/publog.sh$


ý