
¶®#

set -e
if [ "x$1" = 'x' ]; then # usage:
echo "${0##*/} [tocfile]"
exit $$
fi

toc="${1:-_data/toc.yml}
eval "$(cat $toc | eyml)"
echo name: $name
peerid=$(ipfs config Identity.PeerID)
bpath=$(brpath "$peerid" "$name" | xyml bpath)
echo bpath: $bpath

# get the members lists
peers="$(cat $toc | xyml peers | tail +2 | cut -d' ' -f 2)"
for p in $peers; do
echo info: resolving $p
root=$(ipfs name resolve $p)
ppath=$bpath/parent/ # TBC ...
# eval resolved link to get mutable path
eval $(ipfs cat $root/toc.yml | eyml)
qm=$(ipfs files stat --hash $root/toc.yml)
echo qm: $qm 
# copying locally ...
if [ "x$qm" != 'x' ]; then
ipfs files rm -r $ppath
ipfs files cp $qm $ppath
fi

done
®