
‡ÿ#

set -e
file="$1"
bname="${file##*/}"
if [ ! -e $bname ]; then
  if qm=$(ipfs files stat --hash $file 2>/dev/null); then
    ipfs files read $file > $bname
    sed -i 's/prevhash: .*/prevhash: $qm/' $bname
  else
    cat >> $bname <<EOF
--- # $bname
file: $file
tic: $(date +%s)
prevhash: ~
EOF
  fi
fi
gvim --servername BRING --remote-wait-tab-silent $bname
qm=$(ipfs add -Q --raw-leaves --cid-base=base58btc $bname)
if ipfs files rm $file; then true; fi
ipfs files cp /ipfs/$qm $file
ipfs files stat $file

ÿ