
š’#

mydir="${1:-/my}"
gwhost=$(ipfs config Addresses.Gateway | cut -d'/' -f 3)
gwport=$(ipfs config Addresses.Gateway | cut -d'/' -f 5)
peerid=$(ipfs config Identity.PeerID)

echo mydir: $mydir
if qmmy=$(ipfs files stat --hash $mydir) 2>/dev/null; then
 if key=$(ipfs key list -l | grep -w my | cut -d' ' -f 1); then
 echo key: $key
 echo qmmy: $qmmy
 ipfs --offline name publish --key=my --allow-offline /ipfs/$qmmy 1>/dev/null 2>&1 
 echo url: http://gateway.ipfs.io/ipns/$key
 echo url: http://$gwhost:$gwport/ipfs/$qmmy
 time ssh serv01 ipfs name publish --key=my --allow-offline /ipfs/$qmmy 2>/dev/null | sed -e 's/^/info: /'
 fi
else
 echo no $mydir
fi
’